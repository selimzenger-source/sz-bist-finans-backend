{% extends "admin/base.html" %}
{% block title %}{{ 'Yeni IPO' if is_new else 'Düzenle: ' + (ipo.ticker or ipo.company_name) }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Başlık -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-100">
                {% if is_new %}
                    Yeni Halka Arz Oluştur
                {% else %}
                    {{ ipo.ticker or '' }} — {{ ipo.company_name }}
                {% endif %}
            </h1>
            {% if not is_new %}
            <p class="text-sm text-gray-500 mt-1">ID: {{ ipo.id }} | Son güncelleme: {{ ipo.updated_at }}</p>
            {% endif %}
        </div>
        <a href="/admin/" class="text-sm text-indigo-400 hover:text-indigo-300">&larr; Dashboard</a>
    </div>

    <!-- Mesajlar -->
    {% if success %}
    <div class="bg-green-900/50 border border-green-700 text-green-300 px-4 py-3 rounded-lg mb-4 text-sm">
        {{ success }}
    </div>
    {% endif %}
    {% if error %}
    <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg mb-4 text-sm">
        Hata: {{ error }}
    </div>
    {% endif %}

    <!-- Form -->
    <form method="post" action="{{ '/admin/ipo/new' if is_new else '/admin/ipo/' + (ipo.id|string) + '/edit' }}">

        <!-- ====== TEMEL BİLGİLER ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Temel Bilgiler</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Şirket Adı *</label>
                    <input type="text" name="company_name" required
                           value="{{ ipo.company_name if ipo else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Ticker (Hisse Kodu)</label>
                    <input type="text" name="ticker" maxlength="10" placeholder="ATATR"
                           value="{{ ipo.ticker if ipo and ipo.ticker else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono uppercase placeholder-gray-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Status</label>
                    <select name="status"
                            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        {% set statuses = [
                            ('newly_approved', 'SPK Onaylı'),
                            ('in_distribution', 'Dağıtımda'),
                            ('awaiting_trading', 'İşlem Günü Bekliyor'),
                            ('trading', 'İşlem Görüyor'),
                            ('archived', 'Arşiv'),
                        ] %}
                        {% for val, label in statuses %}
                        <option value="{{ val }}" {{ 'selected' if ipo and ipo.status == val else '' }}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Logo URL</label>
                    <input type="url" name="logo_url"
                           value="{{ ipo.logo_url if ipo and ipo.logo_url else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm placeholder-gray-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Sektör</label>
                    <input type="text" name="sector"
                           value="{{ ipo.sector if ipo and ipo.sector else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Konsorsiyum Lideri</label>
                    <input type="text" name="lead_broker"
                           value="{{ ipo.lead_broker if ipo and ipo.lead_broker else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
            </div>
        </div>

        <!-- ====== FİYAT & BÜYÜKLÜK ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Fiyat & Büyüklük</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">
                        Halka Arz Fiyatı (TL)
                        {% if ipo and ipo.manual_fields and 'ipo_price' in (ipo.manual_fields or '') %}
                            <span class="text-yellow-400 ml-1" title="Admin kilidi">&#128274;</span>
                        {% endif %}
                    </label>
                    <input type="text" name="ipo_price" placeholder="11.20"
                           value="{{ ipo.ipo_price if ipo and ipo.ipo_price else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono placeholder-gray-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Toplam Lot</label>
                    <input type="text" name="total_lots" placeholder="15000000"
                           value="{{ ipo.total_lots if ipo and ipo.total_lots else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono placeholder-gray-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Arz Büyüklüğü (TL)</label>
                    <input type="text" name="offering_size_tl" placeholder="168000000"
                           value="{{ ipo.offering_size_tl if ipo and ipo.offering_size_tl else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono placeholder-gray-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Sermaye Artırımı (Lot)</label>
                    <input type="text" name="capital_increase_lots"
                           value="{{ ipo.capital_increase_lots if ipo and ipo.capital_increase_lots else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Ortak Satışı (Lot)</label>
                    <input type="text" name="partner_sale_lots"
                           value="{{ ipo.partner_sale_lots if ipo and ipo.partner_sale_lots else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
            </div>
        </div>

        <!-- ====== TARİHLER ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Tarihler</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">SPK Onay Tarihi</label>
                    <input type="date" name="spk_approval_date"
                           value="{{ ipo.spk_approval_date if ipo and ipo.spk_approval_date else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">
                        Başvuru Başlangıç
                        {% if ipo and ipo.manual_fields and 'subscription_start' in (ipo.manual_fields or '') %}
                            <span class="text-yellow-400 ml-1" title="Admin kilidi">&#128274;</span>
                        {% endif %}
                    </label>
                    <input type="date" name="subscription_start"
                           value="{{ ipo.subscription_start if ipo and ipo.subscription_start else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">
                        Başvuru Bitiş
                        {% if ipo and ipo.manual_fields and 'subscription_end' in (ipo.manual_fields or '') %}
                            <span class="text-yellow-400 ml-1" title="Admin kilidi">&#128274;</span>
                        {% endif %}
                    </label>
                    <input type="date" name="subscription_end"
                           value="{{ ipo.subscription_end if ipo and ipo.subscription_end else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">
                        Başvuru Başlangıç Saati
                        {% if ipo and ipo.manual_fields and 'subscription_hours' in (ipo.manual_fields or '') %}
                            <span class="text-yellow-400 ml-1" title="Admin kilidi — scraper bu alanı ezmez">&#128274;</span>
                        {% endif %}
                    </label>
                    {% set sub_open = '' %}
                    {% if ipo and ipo.subscription_hours %}
                        {% set parts = ipo.subscription_hours.split('-') %}
                        {% if parts|length >= 1 %}
                            {% set sub_open = parts[0]|trim %}
                        {% endif %}
                    {% endif %}
                    <select name="subscription_hour_open"
                            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">Seçiniz</option>
                        {% set time_options = ['08:00','08:30','09:00','09:30','10:00','10:30','11:00','11:30','12:00'] %}
                        {% for t in time_options %}
                        <option value="{{ t }}" {{ 'selected' if sub_open == t else '' }}>{{ t }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">
                        Başvuru Kapanış Saati
                        {% if ipo and ipo.manual_fields and 'subscription_hours' in (ipo.manual_fields or '') %}
                            <span class="text-yellow-400 ml-1" title="Admin kilidi — scraper bu alanı ezmez">&#128274;</span>
                        {% endif %}
                    </label>
                    {% set sub_close = '' %}
                    {% if ipo and ipo.subscription_hours %}
                        {% set parts = ipo.subscription_hours.split('-') %}
                        {% if parts|length >= 2 %}
                            {% set sub_close = parts[1]|trim %}
                        {% endif %}
                    {% endif %}
                    <select name="subscription_hour_close"
                            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">Seçiniz</option>
                        {% set time_options_close = ['12:00','12:30','13:00','13:30','14:00','14:30','15:00','15:30','16:00','16:30','17:00','17:30','18:00','18:30','19:00'] %}
                        {% for t in time_options_close %}
                        <option value="{{ t }}" {{ 'selected' if sub_close == t else '' }}>{{ t }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">
                        İşlem Başlangıç
                        {% if ipo and ipo.manual_fields and 'trading_start' in (ipo.manual_fields or '') %}
                            <span class="text-yellow-400 ml-1" title="Admin kilidi">&#128274;</span>
                        {% endif %}
                    </label>
                    <input type="date" name="trading_start"
                           value="{{ ipo.trading_start if ipo and ipo.trading_start else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">
                        Beklenen İşlem Tarihi
                        {% if ipo and ipo.manual_fields and 'expected_trading_date' in (ipo.manual_fields or '') %}
                            <span class="text-yellow-400 ml-1" title="Admin kilidi">&#128274;</span>
                        {% endif %}
                    </label>
                    <input type="date" name="expected_trading_date"
                           value="{{ ipo.expected_trading_date if ipo and ipo.expected_trading_date else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
            </div>
        </div>

        <!-- ====== DAĞITIM & KATILIM ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Dağıtım & Katılım</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Dağıtım Yöntemi</label>
                    <select name="distribution_method"
                            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">Seçiniz</option>
                        {% set dist_methods = [
                            ('esit', 'Eşit Dağıtım'),
                            ('bireysele_esit', 'Bireysele Eşit'),
                            ('tamami_esit', 'Tamamı Eşit'),
                            ('oransal', 'Oransal'),
                            ('karma', 'Karma'),
                        ] %}
                        {% for val, label in dist_methods %}
                        <option value="{{ val }}" {{ 'selected' if ipo and ipo.distribution_method == val else '' }}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Katılım Yöntemi</label>
                    <select name="participation_method"
                            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">Seçiniz</option>
                        {% set part_methods = [
                            ('talep_toplama', 'Talep Toplama'),
                            ('borsada_satis', 'Borsada Satış'),
                        ] %}
                        {% for val, label in part_methods %}
                        <option value="{{ val }}" {{ 'selected' if ipo and ipo.participation_method == val else '' }}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Pazar Segmenti</label>
                    <select name="market_segment"
                            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                        <option value="">Seçiniz</option>
                        {% set markets = [
                            ('yildiz_pazar', 'Yıldız Pazar'),
                            ('ana_pazar', 'Ana Pazar'),
                            ('alt_pazar', 'Alt Pazar'),
                        ] %}
                        {% for val, label in markets %}
                        <option value="{{ val }}" {{ 'selected' if ipo and ipo.market_segment == val else '' }}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Tahmini Kişi Başı Lot</label>
                    <input type="text" name="estimated_lots_per_person"
                           value="{{ ipo.estimated_lots_per_person if ipo and ipo.estimated_lots_per_person else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Halka Açıklık (%)</label>
                    <input type="text" name="public_float_pct" placeholder="25.50"
                           value="{{ ipo.public_float_pct if ipo and ipo.public_float_pct else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono placeholder-gray-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">İskonto (%)</label>
                    <input type="text" name="discount_pct" placeholder="15.00"
                           value="{{ ipo.discount_pct if ipo and ipo.discount_pct else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono placeholder-gray-500">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Dağıtım Açıklaması</label>
                    <textarea name="distribution_description" rows="2"
                              class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm">{{ ipo.distribution_description if ipo and ipo.distribution_description else '' }}</textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Katılım Açıklaması</label>
                    <textarea name="participation_description" rows="2"
                              class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm">{{ ipo.participation_description if ipo and ipo.participation_description else '' }}</textarea>
                </div>
            </div>

            <div class="flex items-center gap-6 mt-4">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="distribution_completed" value="on"
                           {{ 'checked' if ipo and ipo.distribution_completed else '' }}
                           class="w-4 h-4 text-indigo-600 rounded bg-gray-700 border-gray-600">
                    <span class="text-sm text-gray-300">Dağıtım tamamlandı</span>
                </label>
            </div>
        </div>

        <!-- ====== EK BİLGİLER ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Ek Bilgiler</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">SPK Bülten No</label>
                    <input type="text" name="spk_bulletin_no" placeholder="2026/5"
                           value="{{ ipo.spk_bulletin_no if ipo and ipo.spk_bulletin_no else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none placeholder-gray-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Lock-up (gün)</label>
                    <input type="text" name="lock_up_period_days"
                           value="{{ ipo.lock_up_period_days if ipo and ipo.lock_up_period_days else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Fiyat İstikrarı (gün)</label>
                    <input type="text" name="price_stability_days"
                           value="{{ ipo.price_stability_days if ipo and ipo.price_stability_days else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Min Başvuru Lot</label>
                    <input type="text" name="min_application_lot"
                           value="{{ ipo.min_application_lot if ipo and ipo.min_application_lot else '1' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
            </div>
        </div>

        <!-- ====== ŞİRKET BİLGİLERİ ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Şirket Bilgileri</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-400 mb-1">Şirket Açıklaması</label>
                <textarea name="company_description" rows="3"
                          class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm">{{ ipo.company_description if ipo and ipo.company_description else '' }}</textarea>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-400 mb-1">Fon Kullanım Hedefleri</label>
                <textarea name="fund_usage" rows="2"
                          class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm">{{ ipo.fund_usage if ipo and ipo.fund_usage else '' }}</textarea>
            </div>
        </div>

        <!-- ====== MALİ VERİLER ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Mali Veriler</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Güncel Yıl Hasılat (TL)</label>
                    <input type="text" name="revenue_current_year"
                           value="{{ ipo.revenue_current_year if ipo and ipo.revenue_current_year else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Önceki Yıl Hasılat (TL)</label>
                    <input type="text" name="revenue_previous_year"
                           value="{{ ipo.revenue_previous_year if ipo and ipo.revenue_previous_year else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Brüt Kâr (TL)</label>
                    <input type="text" name="gross_profit"
                           value="{{ ipo.gross_profit if ipo and ipo.gross_profit else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
            </div>
        </div>

        <!-- ====== LİNKLER ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Linkler</h2>
            <div class="grid grid-cols-1 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">KAP Bildirim URL</label>
                    <input type="url" name="kap_notification_url"
                           value="{{ ipo.kap_notification_url if ipo and ipo.kap_notification_url else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">İzahname PDF URL</label>
                    <input type="url" name="prospectus_url"
                           value="{{ ipo.prospectus_url if ipo and ipo.prospectus_url else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">SPK Bülten URL</label>
                    <input type="url" name="spk_bulletin_url"
                           value="{{ ipo.spk_bulletin_url if ipo and ipo.spk_bulletin_url else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                </div>
            </div>
        </div>

        <!-- ====== TAKİP & ARŞİV ====== -->
        <div class="bg-gray-800 rounded-xl shadow-sm p-6 mb-4 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-2">Takip & Arşiv</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Toplam Başvuran</label>
                    <input type="text" name="total_applicants"
                           value="{{ ipo.total_applicants if ipo and ipo.total_applicants else '' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">İşlem Günü Sayacı</label>
                    <input type="text" name="trading_day_count"
                           value="{{ ipo.trading_day_count if ipo else '0' }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono">
                </div>
            </div>
            <div class="flex flex-wrap items-center gap-6">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="allocation_announced" value="on"
                           {{ 'checked' if ipo and ipo.allocation_announced else '' }}
                           class="w-4 h-4 text-indigo-600 rounded bg-gray-700 border-gray-600">
                    <span class="text-sm text-gray-300">Dağıtım sonucu açıklandı</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="ceiling_tracking_active" value="on"
                           {{ 'checked' if ipo and ipo.ceiling_tracking_active else '' }}
                           class="w-4 h-4 text-indigo-600 rounded bg-gray-700 border-gray-600">
                    <span class="text-sm text-gray-300">Tavan takip aktif</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="ceiling_broken" value="on"
                           {{ 'checked' if ipo and ipo.ceiling_broken else '' }}
                           class="w-4 h-4 text-indigo-600 rounded bg-gray-700 border-gray-600">
                    <span class="text-sm text-gray-300">Tavan kırıldı</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="archived" value="on"
                           {{ 'checked' if ipo and ipo.archived else '' }}
                           class="w-4 h-4 text-indigo-600 rounded bg-gray-700 border-gray-600">
                    <span class="text-sm text-gray-300">Arşivlenmiş</span>
                </label>
            </div>
        </div>

        <!-- ====== KAYDET ====== -->
        <div class="flex items-center justify-between mt-6 mb-8">
            <a href="/admin/" class="text-gray-500 hover:text-gray-300 text-sm">İptal</a>
            <div class="flex items-center gap-3">
                {% if not is_new %}
                <a href="/admin/ipo/{{ ipo.id }}/allocations"
                   class="bg-emerald-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-emerald-700 transition text-sm">
                    Dağıtım Sonuçları
                </a>
                {% endif %}
                <button type="submit"
                        class="bg-indigo-500 text-white px-8 py-2 rounded-lg font-medium hover:bg-indigo-600 transition">
                    {{ 'Oluştur' if is_new else 'Kaydet' }}
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}
